<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syntropic Constellation Dashboard</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #canvas {
            display: block;
            background: #000;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            max-width: 300px;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            background: #444;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="info">
        <h3>Syntropic Constellation</h3>
        <p>Protocols 61-80 as Stars</p>
        <p id="selected">Click a star for details</p>
    </div>
    <div id="controls">
        <button id="zoomIn">Zoom In</button>
        <button id="zoomOut">Zoom Out</button>
        <button id="reset">Reset View</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const info = document.getElementById('selected');
        let constellationData = {};
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let selectedProtocol = null;

        // Load constellation data
        fetch('constellation_data.json')
            .then(response => response.json())
            .then(data => {
                constellationData = data;
                resizeCanvas();
                draw();
            })
            .catch(err => console.error('Failed to load constellation data:', err));

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width / 2 + offsetX, canvas.height / 2 + offsetY);
            ctx.scale(scale, scale);

            // Draw links
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            for (let pid in constellationData) {
                const p = constellationData[pid];
                p.links.forEach(linkId => {
                    if (constellationData[linkId]) {
                        const link = constellationData[linkId];
                        ctx.beginPath();
                        ctx.moveTo(p.dynamic_coords.x, p.dynamic_coords.y);
                        ctx.lineTo(link.dynamic_coords.x, link.dynamic_coords.y);
                        ctx.stroke();
                    }
                });
            }

            // Draw stars
            for (let pid in constellationData) {
                const p = constellationData[pid];
                const x = p.dynamic_coords.x;
                const y = p.dynamic_coords.y;
                const size = selectedProtocol == pid ? 8 : 5;
                ctx.fillStyle = selectedProtocol == pid ? '#ffff00' : '#ffffff';
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }

            ctx.restore();
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left - canvas.width / 2 - offsetX) / scale;
            const y = (e.clientY - rect.top - canvas.height / 2 - offsetY) / scale;
            selectedProtocol = null;
            for (let pid in constellationData) {
                const p = constellationData[pid];
                const dx = x - p.dynamic_coords.x;
                const dy = y - p.dynamic_coords.y;
                if (Math.sqrt(dx * dx + dy * dy) < 10) {
                    selectedProtocol = pid;
                    info.innerHTML = `<strong>${p.name}</strong><br>${p.desc}`;
                    break;
                }
            }
            if (!selectedProtocol) {
                info.innerHTML = 'Click a star for details';
            }
            draw();
        });

        document.getElementById('zoomIn').addEventListener('click', () => {
            scale *= 1.2;
            draw();
        });

        document.getElementById('zoomOut').addEventListener('click', () => {
            scale /= 1.2;
            draw();
        });

        document.getElementById('reset').addEventListener('click', () => {
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            draw();
        });

        window.addEventListener('resize', () => {
            resizeCanvas();
            draw();
        });

        // Auto-refresh every 30 seconds
        setInterval(() => {
            fetch('constellation_data.json')
                .then(response => response.json())
                .then(data => {
                    constellationData = data;
                    draw();
                });
        }, 30000);
    </script>
</body>
</html>